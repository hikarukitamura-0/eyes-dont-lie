# **ディープラーニング要件定義書**

プロジェクト名: Zone Key  
コンポーネント: AI/ML 推論エンジン  
最終更新日: 2025-12-11

## **1. 概要**

PC エージェント上で動作するエッジ AI システム。キーストローク・ダイナミクスと環境データから、ユーザーの集中度・疲労度をリアルタイムで推論し、最適な作業提案とハードウェア制御を行う。

## **2. データ収集要件**

### **2.1 キーストローク・ダイナミクス**

| データ項目             | 詳細                               | 取得頻度     |
| :--------------------- | :--------------------------------- | :----------- |
| **打鍵間隔**           | 連続するキー入力間の時間（ミリ秒） | リアルタイム |
| **打鍵間隔のゆらぎ**   | 標準偏差、変動係数の計算           | 1 分ごと     |
| **ミスタッチ修正頻度** | Backspace や Delete キーの使用回数 | 1 分ごと     |
| **キー押下時間**       | Key Down から Key Up までの時間    | リアルタイム |
| **タイピング速度**     | 1 分あたりの打鍵数（KPM）          | 1 分ごと     |

**プライバシー保護:**

- キーの内容（文字）は一切取得しない
- メタデータ（タイミング情報）のみを記録
- ローカルストレージへの一時保存後、匿名化してクラウド送信

### **2.2 マウス動作データ**

| データ項目       | 詳細                                   | 取得頻度 |
| :--------------- | :------------------------------------- | :------- |
| **移動距離**     | マウスカーソルの総移動距離（ピクセル） | 1 分ごと |
| **クリック頻度** | 左/右クリック、ダブルクリックの回数    | 1 分ごと |
| **停止時間**     | カーソルが静止している時間の割合       | 1 分ごと |
| **移動速度**     | カーソル移動速度の平均と分散           | 1 分ごと |

### **2.3 環境データ**

| データ項目     | 取得元               | 取得頻度     |
| :------------- | :------------------- | :----------- |
| **室温**       | M5Stack ENV III Unit | 10 秒ごと    |
| **湿度**       | M5Stack ENV III Unit | 10 秒ごと    |
| **気圧**       | M5Stack ENV III Unit | 10 秒ごと    |
| **時刻**       | システム時計         | リアルタイム |
| **騒音レベル** | マイク（オプション） | 10 秒ごと    |

### **2.4 作業コンテキストデータ**

| データ項目                 | 詳細                                        | 取得頻度 |
| :------------------------- | :------------------------------------------ | :------- |
| **アクティブウィンドウ名** | 現在フォーカスされているアプリケーション    | 5 秒ごと |
| **作業カテゴリ**           | 開発/コミュニケーション/ブラウジング/その他 | 5 秒ごと |
| **ウィンドウ切り替え頻度** | 1 分間のウィンドウ切り替え回数              | 1 分ごと |

## **3. モデル設計要件**

### **3.1 アーキテクチャ**

**モデル種別:** LSTM (Long Short-Term Memory)

**理由:**

- 時系列データの長期依存関係を学習可能
- 打鍵リズムの「クセ」や「疲労の蓄積」を捉えられる
- エッジデバイスでも推論可能な軽量性

**代替候補:**

- Transformer (精度重視の場合)
- GRU (軽量化優先の場合)
- 1D CNN + LSTM ハイブリッド (特徴抽出強化)

### **3.2 入力設計**

**時系列ウィンドウ:** 過去 10 分間のデータ（スライディングウィンドウ）

**入力特徴量:**

```python
# 行動データ（14次元）
- 打鍵間隔の平均・標準偏差・最大・最小
- 打鍵速度（KPM）
- ミスタッチ頻度
- マウス移動距離・速度・クリック頻度
- ウィンドウ切り替え頻度
- 作業カテゴリ（One-Hot Encoding）

# 環境データ（4次元）
- 室温（正規化）
- 湿度（正規化）
- 気圧（正規化）
- 時刻（Cyclical Encoding: sin/cos）

# 合計: 18次元 × 600タイムステップ（10分間、1秒ごと）
```

### **3.3 出力設計**

**出力 1: 集中度スコア**

- 範囲: 0.0 ~ 1.0（連続値）
- 意味: 1.0 = 最高集中状態、0.0 = 集中力ゼロ

**出力 2: 疲労予測**

- 範囲: 0 ~ 120（分）
- 意味: 疲労限界到達までの残り時間

**出力 3: 状態分類**

- Deep Focus（集中度 > 0.7）
- Open（0.3 ≤ 集中度 ≤ 0.7）
- Overheat（集中度 < 0.3 または疲労予測 < 10 分）

### **3.4 モデル構造**

```python
# 提案アーキテクチャ
Input(18 features × 600 timesteps)
    ↓
LSTM Layer 1 (128 units, return_sequences=True)
    ↓
Dropout(0.3)
    ↓
LSTM Layer 2 (64 units, return_sequences=False)
    ↓
Dropout(0.3)
    ↓
Dense(32, activation='relu')
    ↓
Output Branches:
  ├─ Dense(1, activation='sigmoid') → 集中度スコア
  ├─ Dense(1, activation='linear') → 疲労予測（分）
  └─ Dense(3, activation='softmax') → 状態分類
```

## **4. 学習要件**

### **4.1 データセット構築**

**Phase 1: 初期データ収集（2 週間）**

- チームメンバー 5 名が日常業務中にプロトタイプを使用
- 1 日 8 時間 × 10 営業日 = 400 時間分のデータ
- 自己申告による「集中度」ラベル付け（30 分ごと）

**Phase 2: アノテーション**

- 主観的集中度（1~5 の 5 段階評価）
- タスク達成度（目標に対する進捗率）
- 休憩取得タイミングの記録

**Phase 3: データ拡張**

- ノイズ付加（打鍵間隔に ±5%のジッター）
- 時間軸のストレッチ/圧縮

### **4.2 損失関数**

```python
# マルチタスク学習
total_loss = α × focus_loss + β × fatigue_loss + γ × state_loss

# 集中度: MSE（平均二乗誤差）
focus_loss = MSE(predicted_focus, true_focus)

# 疲労予測: Huber Loss（外れ値に強い）
fatigue_loss = HuberLoss(predicted_fatigue, true_fatigue)

# 状態分類: Categorical Cross-Entropy
state_loss = CrossEntropy(predicted_state, true_state)

# 重み: α=0.4, β=0.3, γ=0.3
```

### **4.3 パーソナライズ**

**転移学習アプローチ:**

1. 全ユーザーの集約データでベースモデルを学習
2. 個人データ（1 週間分）でファインチューニング
3. 継続的なオンライン学習（週次更新）

**個人差の考慮:**

- 「遅いタイピング = 疲労」とは限らない（個人の平均値からの乖離を重視）
- 朝型/夜型のバイオリズム差を学習
- 作業スタイル（長時間集中型 vs 短期集中型）の識別

## **5. 推論要件**

### **5.1 エッジ AI 推論**

**実行環境:**

- PC 上（Windows/macOS）
- Python 3.9+
- TensorFlow Lite または ONNX Runtime

**パフォーマンス要件:**

- 推論頻度: 1 分ごと
- レイテンシ: < 100ms（CPU 推論）
- メモリ使用量: < 500MB

### **5.2 リアルタイム処理フロー**

```
[データ収集スレッド]
    ↓ 1秒ごと
[バッファ（過去10分間）]
    ↓ 1分ごと
[前処理・正規化]
    ↓
[LSTM推論]
    ↓
[後処理・状態判定]
    ↓
├─ [ハードウェア制御（LED色変更）]
└─ [クラウド送信（非同期）]
```

## **6. 環境要因分析**

### **6.1 環境-生産性相関分析**

**分析手法:** 重回帰分析 + 決定木

**目的:**

- 「室温 ○℃、湿度 ○%の時に最も集中力が高い」を特定
- 個人ごとの最適環境条件をプロファイリング

**出力:**

```python
{
  "optimal_temperature": 24.5,  # 最適室温（℃）
  "optimal_humidity": 50.0,     # 最適湿度（%）
  "temperature_sensitivity": 0.8,  # 温度への感度（0~1）
  "best_time_slots": ["09:00-11:00", "14:00-16:00"]  # 集中しやすい時間帯
}
```

### **6.2 異常検知**

**目的:** 環境変化による急激な生産性低下を検出

**手法:** Isolation Forest（教師なし学習）

**検知対象:**

- 気温の急上昇/急降下（±3℃/30 分）
- 湿度の異常値（< 30% or > 70%）
- 騒音レベルの急増（マイク搭載時）

## **7. 評価指標**

### **7.1 精度評価**

| 指標                   | 目標値         | 評価方法                 |
| :--------------------- | :------------- | :----------------------- |
| **集中度スコアの誤差** | RMSE < 0.15    | テストデータでの予測誤差 |
| **状態分類の精度**     | Accuracy > 85% | 3 クラス分類の正答率     |
| **疲労予測の誤差**     | MAE < 15 分    | 実際の休憩取得時刻との差 |

### **7.2 ユーザー評価**

- 「推奨タスクが適切だった」割合 > 80%
- 「割り込み防止効果があった」実感 > 70%
- 「疲労予測が当たっていた」評価 > 75%

## **8. 技術的課題とリスク**

| 課題                 | リスク             | 対策                                |
| :------------------- | :----------------- | :---------------------------------- |
| **ラベルデータ不足** | 学習精度低下       | 自己申告 + タスク達成度の組み合わせ |
| **個人差が大きい**   | 汎化性能低下       | パーソナライズ学習の強化            |
| **環境ノイズ**       | 誤推論の増加       | データ拡張 + ロバスト性向上         |
| **プライバシー懸念** | ユーザー離脱       | キー内容を一切取得しない設計        |
| **モデルドリフト**   | 長期使用で精度低下 | 継続的な再学習パイプライン          |

## **9. 実装優先順位**

### **Phase 1: MVP（最小機能）**

- [ ] キーストローク収集スクリプト
- [ ] 単純閾値ベースの状態判定（AI 不使用）
- [ ] LED 制御の動作確認

### **Phase 2: AI 導入**

- [ ] データ収集とアノテーション（2 週間）
- [ ] LSTM モデルの構築と学習
- [ ] エッジ推論の実装

### **Phase 3: 高度化**

- [ ] パーソナライズ学習
- [ ] 環境要因分析
- [ ] オンライン学習パイプライン

## **10. 参考文献・技術資料**

### **関連研究**

- Keystroke Dynamics for User Authentication (Bailey et al.)
- Predicting Mental Fatigue from Typing Behavior (Vizer et al.)
- LSTM for Time Series Classification (Karim et al.)

### **使用ライブラリ**

- TensorFlow / PyTorch（学習）
- TensorFlow Lite / ONNX Runtime（推論）
- pynput（キー入力取得）
- psutil（システム情報取得）

