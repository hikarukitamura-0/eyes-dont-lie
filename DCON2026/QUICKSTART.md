# Zone Key - クイックスタートガイド

<div align="center">

**5 分で始めるデータ収集プログラム**

</div>

---

## ⚡ クイックスタート

### 1. セットアップ（初回のみ）

```bash
# 1. プロジェクトディレクトリに移動
cd /Users/kento/school/Procon/DCON2026

# 2. 仮想環境をアクティベート
source .venv/bin/activate

# 3. 依存パッケージがインストールされているか確認
pip list | grep pynput
```

### 2. PVT テストの動作確認

```bash
cd src
python main.py --test-pvt
```

**期待される動作:**

1. 画面中央に小さなウィンドウ（400×300）が最前面に表示される
2. 「🔴 が表示されたら、できるだけ早くスペースキーを押してください」と表示
3. **0.5-1.5 秒後**に 🔴（赤い円）が表示される
4. スペースキーを押すと反応時間が表示される
5. 2 秒後に自動で終了

**注**:

- ESC キーでテストをスキップできます
- 全画面ではなく小さなウィンドウなので、作業の邪魔になりません
- 待機時間を最小限（0.5-1.5 秒）にし、素早くテストが完了します

### 3. データ収集プログラムの実行

```bash
# 管理者権限で実行（キーストローク収集のため）
sudo python main.py
```

**実行中の画面:**

```
==========================================================
          Zone Key データ収集システム v2.0
==========================================================

データ収集モジュールを初期化しています...
==========================================================

✓ キーストローク収集を開始しました
✓ マウス動作収集を開始しました
⚠ M5Stack接続エラー: ...
  モックデータを使用します

✓ すべてのモジュールを初期化しました

📅 初回PVTテスト予定: 14:30:00
   （45.2分後）

==========================================================
データ収集を開始します
==========================================================

⚠ 重要:
  - PVTテスト実行中は作業を中断し、テストに集中してください
  - テストは5分ごとに実行されます
  - ESCキーでテストをスキップできます

📅 次回PVTテスト: 14:30:00

==========================================================

✓ [2025-12-11 13:45:00] データ保存完了
✓ [2025-12-11 13:46:00] データ保存完了
...
```

### 4. プログラムの停止

`Ctrl+C` を押すと、統計情報が表示されて終了します。

```
^C

==========================================================
データ収集を停止します...
==========================================================

==========================================================
📈 データ収集統計
==========================================================

✓ 収集データ数: 120レコード
✓ PVTテスト回数: 3回
✓ 平均反応時間: 350ms
✓ 全体的な覚醒度: 通常

==========================================================

収集モジュールを停止しています...
✓ キーストローク収集を停止しました
✓ マウス動作収集を停止しました
✓ M5Stack接続を閉じました
✓ すべてのモジュールを停止しました
✓ データベース接続を閉じました
✓ すべてのモジュールを停止しました

プログラムを終了します。
```

---

## 📊 収集されたデータの確認

### データベースの確認

```bash
# SQLiteデータベースを開く
sqlite3 zone_key_data.db

# テーブル一覧を表示
.tables

# training_dataの件数を確認
SELECT COUNT(*) FROM training_data;

# pvt_resultsの件数を確認
SELECT COUNT(*) FROM pvt_results;

# 最新のPVT結果を表示
SELECT * FROM pvt_results ORDER BY timestamp DESC LIMIT 5;

# 終了
.quit
```

### CSV ファイルとしてエクスポート

```bash
# Pythonインタラクティブシェルを起動
python

# 以下のコードを実行
>>> from data_storage import DataStorage
>>> storage = DataStorage()
>>> storage.export_to_csv("my_training_data.csv")
>>> storage.export_pvt_dataset("my_pvt_dataset.csv")
>>> storage.close()
>>> exit()
```

---

## 🔧 トラブルシューティング

### エラー: "Permission denied" （macOS）

**原因**: キーストローク収集に管理者権限が必要

**解決策**:

```bash
sudo python main.py
```

### エラー: "AppKit が利用できません"（macOS）

**原因**: pyobjc がインストールされていない

**解決策**:

```bash
pip install pyobjc-framework-Cocoa
```

### エラー: "M5Stack 接続エラー"

**原因**: M5Stack が接続されていない、またはポートが間違っている

**解決策**:

1. M5Stack なしでも動作します（モックデータを使用）
2. M5Stack を使用する場合:

```bash
# macOS: ポートを探す
ls /dev/tty.*

# 正しいポートを指定して実行
sudo python main.py --m5stack /dev/tty.usbserial-xxxxx
```

---

## 📝 データ収集のベストプラクティス

### 1. 定期的な実行

- **1 日 8 時間**の作業時間中に実行
- 朝の作業開始時にプログラムを起動
- 終業時に`Ctrl+C`で停止

### 2. PVT テストへの対応

- テスト開始の通知が表示されたら、**すぐに反応する**
- フライング（早押し）しない
- 正確に反応することが重要

### 3. データの品質管理

- 週に 1 回、データベースの統計を確認
- PVT テストが**1 日約 96 回**（8 時間 × 12 回/時）実行されているか確認
- 異常なデータ（反応時間 > 2000ms など）がないか確認

---

## 🎯 次のステップ

データ収集が完了したら:

1. **データのエクスポート**

   ```bash
   python
   >>> from data_storage import DataStorage
   >>> storage = DataStorage()
   >>> storage.export_pvt_dataset("final_dataset.csv")
   ```

2. **ディープラーニングモデルの学習**

   - `docs/ディープラーニング要件定義書.md` を参照
   - LSTM モデルの構築と学習

3. **モデルの評価**
   - テストデータでの精度評価
   - 集中度推定の妥当性検証

---

## 📚 関連ドキュメント

- **README.md**: プログラムの詳細な説明
- **docs/データセット収集プログラム設計書.md**: 設計書
- **docs/集中度測定方法の詳細設計.md**: PVT の詳細

---

<div align="center">

**Happy Data Collecting! 🎉**

ご質問やバグ報告は、開発チームまでお気軽にどうぞ。

</div>
